[0;34m[2025-05-05T12:47:31] [INFO] Starting script: nextLevel3.sh (v2.9)[0m
[0;34m[2025-05-05T12:47:31] [INFO] Verifying Xcode Command-Line Tools…[0m
[0;34m[2025-05-05T12:47:31] [INFO] Checking: xcode-select -p &>/dev/null[0m
[0;34m[2025-05-05T12:47:31] [INFO] Bootstrapping Homebrew…[0m
[0;34m[2025-05-05T12:47:31] [INFO] Checking: command -v brew &>/dev/null[0m
[0;34m[2025-05-05T12:47:31] [INFO] Checking: brew --version &>/dev/null[0m
[0;34m[2025-05-05T12:47:31] [INFO] Checking: [[ -d /opt/homebrew ]][0m
[0;34m[2025-05-05T12:47:31] [INFO] Evaluating Homebrew shell environment...[0m
[0;34m[2025-05-05T12:47:31] [INFO] Homebrew ready.[0m
[0;34m[2025-05-05T12:47:31] [INFO] Installing brew formulae…[0m
[0;34m[2025-05-05T12:47:31] [INFO] ▶ brew update[0m
==> Updating Homebrew...
Already up-to-date.
[0;34m[2025-05-05T12:47:33] [INFO] ▶ brew install mise colima docker docker-buildx docker-compose cloudflared jq[0m
Warning: Treating docker as a formula. For the cask, use homebrew/cask/docker or specify the `--cask` flag. To silence this message, use the `--formula` flag.
Warning: mise 2025.5.0 is already installed and up-to-date.
To reinstall 2025.5.0, run:
  brew reinstall mise
Warning: colima 0.8.1 is already installed and up-to-date.
To reinstall 0.8.1, run:
  brew reinstall colima
Warning: docker 28.1.1 is already installed and up-to-date.
To reinstall 28.1.1, run:
  brew reinstall docker
Warning: docker-buildx 0.23.0 is already installed and up-to-date.
To reinstall 0.23.0, run:
  brew reinstall docker-buildx
Warning: docker-compose 2.35.1 is already installed and up-to-date.
To reinstall 2.35.1, run:
  brew reinstall docker-compose
Warning: cloudflared 2025.4.2 is already installed and up-to-date.
To reinstall 2025.4.2, run:
  brew reinstall cloudflared
Warning: jq 1.7.1 is already installed and up-to-date.
To reinstall 1.7.1, run:
  brew reinstall jq
[0;34m[2025-05-05T12:47:34] [INFO] Installing brew casks…[0m
[0;34m[2025-05-05T12:47:34] [INFO] ▶ brew install --cask volta macs-fan-control raycast warp rectangle-pro betterdisplay hummingbird yubico-yubikey-manager yubico-authenticator knockknock blockblock nordvpn[0m
Warning: Not upgrading volta, the latest version is already installed
Warning: Not upgrading macs-fan-control, the latest version is already installed
Warning: Not upgrading raycast, the latest version is already installed
Warning: Not upgrading warp, the latest version is already installed
Warning: Not upgrading rectangle-pro, the latest version is already installed
Warning: Not upgrading betterdisplay, the latest version is already installed
Warning: Not upgrading hummingbird, the latest version is already installed
Warning: Not upgrading yubico-yubikey-manager, the latest version is already installed
Warning: Not upgrading yubico-authenticator, the latest version is already installed
Warning: Not upgrading knockknock, the latest version is already installed
Warning: Not upgrading blockblock, the latest version is already installed
Warning: Not upgrading nordvpn, the latest version is already installed
[0;34m[2025-05-05T12:47:35] [INFO] Configuring Mise…[0m
[0;34m[2025-05-05T12:47:35] [INFO] ▶ grep -q 'mise activate' ~/.zshrc || echo 'eval "$(mise activate zsh)"' >> ~/.zshrc[0m
[0;34m[2025-05-05T12:47:35] [INFO] Checking: command -v mise &>/dev/null[0m
[0;34m[2025-05-05T12:47:35] [INFO] Activating Mise in script session…[0m
[0;34m[2025-05-05T12:47:35] [INFO] ▶ mise use -g node@lts python@3.12 rust@stable go@1.22[0m
mise ~/.config/mise/config.toml tools: go@1.22.12, rust@stable, python@3.12.10, node@22.15.0
[0;34m[2025-05-05T12:47:35] [INFO] Starting Colima VM…[0m
[0;34m[2025-05-05T12:47:35] [INFO] ▶ colima start --arch aarch64 --vm-type vz --vz-rosetta || true[0m
time="2025-05-05T12:47:36-04:00" level=warning msg="already running, ignoring"
[0;34m[2025-05-05T12:47:36] [INFO] Adding low-power aliases…[0m
[0;34m[2025-05-05T12:47:36] [INFO] ▶ grep -q lpm-on ~/.zshrc || echo 'alias lpm-on="sudo powermetrics -q --lowpowermode on"' >> ~/.zshrc[0m
[0;34m[2025-05-05T12:47:36] [INFO] ▶ grep -q lpm-off ~/.zshrc || echo 'alias lpm-off="sudo powermetrics -q --lowpowermode off"' >> ~/.zshrc[0m
[0;34m[2025-05-05T12:47:36] [INFO] Configuring macOS Firewall & TouchID for sudo…[0m
[0;34m[2025-05-05T12:47:36] [INFO] ▶ sudo /usr/libexec/ApplicationFirewall/socketfilterfw --setstealthmode on[0m
[0;34m[2025-05-05T12:47:47] [INFO] ▶ grep -qF 'auth\tsufficient\tpam_tid.so' /etc/pam.d/sudo || echo -e 'auth\tsufficient\tpam_tid.so' | sudo tee -a /etc/pam.d/sudo >/dev/null[0m
[0;34m[2025-05-05T12:47:47] [INFO] Attempting to generate YubiKey SSH key…[0m
[0;34m[2025-05-05T12:47:47] [INFO] Checking: ssh-keygen -t ed25519-sk -f ~/.ssh/id_ed25519_sk -N '' -O resident 2>/dev/null[0m
[0;33m[2025-05-05T12:47:47] [WARN] No FIDO2 device found; skipping YubiKey keygen[0m
[0;34m[2025-05-05T12:47:47] [INFO] Installing battery alert agent…[0m
[0;34m[2025-05-05T12:47:47] [INFO] ▶ chmod +x ~/Scripts/battAlert.sh[0m
[0;34m[2025-05-05T12:47:47] [INFO] Battery alert agent: lint, unload & bootstrap[0m
[0;34m[2025-05-05T12:47:47] [INFO] ▶ plutil -lint /Users/marcussmith/Library/LaunchAgents/com.local.battAlert.plist[0m
/Users/marcussmith/Library/LaunchAgents/com.local.battAlert.plist: OK
[0;34m[2025-05-05T12:47:47] [INFO] ▶ launchctl list com.local.battalert &&     launchctl bootout gui/501 /Users/marcussmith/Library/LaunchAgents/com.local.battAlert.plist || true[0m
{
	"LimitLoadToSessionType" = "Aqua";
	"Label" = "com.local.battalert";
	"OnDemand" = true;
	"LastExitStatus" = 19968;
	"Program" = "$HOME/Scripts/battAlert.sh";
	"ProgramArguments" = (
		"$HOME/Scripts/battAlert.sh";
	);
};
[0;34m[2025-05-05T12:47:47] [INFO] Bootstrapped battery alert agent ✔[0m
[0;34m[2025-05-05T12:47:47] [INFO] Installing weekly audit agent…[0m
[0;34m[2025-05-05T12:47:47] [INFO] ▶ chmod +x ~/Scripts/weeklyAudit.sh[0m
[0;34m[2025-05-05T12:47:47] [INFO] Loading agent com.local.weeklyaudit…[0m
[0;34m[2025-05-05T12:47:47] [INFO] Installing Ollama & pulling Mistral model…[0m
[0;34m[2025-05-05T12:47:47] [INFO] ▶ brew install ollama[0m
Warning: Treating ollama as a formula. For the cask, use homebrew/cask/ollama or specify the `--cask` flag. To silence this message, use the `--formula` flag.
Warning: ollama 0.6.7 is already installed and up-to-date.
To reinstall 0.6.7, run:
  brew reinstall ollama
[0;34m[2025-05-05T12:47:48] [INFO] ▶ brew services start ollama || true[0m
Service `ollama` already started, use `brew services restart ollama` to restart.
[0;34m[2025-05-05T12:47:49] [INFO] ▶ ollama pull mistral:7b || true[0m
[?2026h[?25l[1Gpulling manifest ⠋ [K[?25h[?2026l[?2026h[?25l[1Gpulling manifest ⠙ [K[?25h[?2026l[?2026h[?25l[1Gpulling manifest ⠹ [K[?25h[?2026l[?2026h[?25l[1Gpulling manifest ⠸ [K[?25h[?2026l[?2026h[?25l[1Gpulling manifest [K
pulling ff82381e2bea: 100% ▕██████████████████▏ 4.1 GB                         [K
pulling 43070e2d4e53: 100% ▕██████████████████▏  11 KB                         [K
pulling 491dfa501e59: 100% ▕██████████████████▏  801 B                         [K
pulling ed11eda7790d: 100% ▕██████████████████▏   30 B                         [K
pulling 42347cd80dc8: 100% ▕██████████████████▏  485 B                         [K
verifying sha256 digest [K
writing manifest [K
success [K[?25h[?2026l
[0;34m[2025-05-05T12:47:50] [INFO] ▶ plutil -lint /Users/marcussmith/Library/LaunchAgents/com.local.weeklyaudit.plist[0m
/Users/marcussmith/Library/LaunchAgents/com.local.weeklyaudit.plist: OK
[0;34m[2025-05-05T12:47:50] [INFO] ▶ launchctl list com.local.weeklyaudit && launchctl bootout gui/501 /Users/marcussmith/Library/LaunchAgents/com.local.weeklyaudit.plist || true[0m
{
	"LimitLoadToSessionType" = "Aqua";
	"Label" = "com.local.weeklyaudit";
	"OnDemand" = true;
	"LastExitStatus" = 19968;
	"Program" = "$HOME/Scripts/weeklyAudit.sh";
	"ProgramArguments" = (
		"$HOME/Scripts/weeklyAudit.sh";
	);
};
[0;34m[2025-05-05T12:47:50] [INFO] Bootstrapped weekly audit agent ✔[0m
[0;34m[2025-05-05T12:47:50] [INFO] Configuring passwordless sudo for networksetup…[0m
[0;34m[2025-05-05T12:47:50] [INFO] Checking: sudo -n true 2>/dev/null[0m
[0;34m[2025-05-05T12:47:50] [INFO] (Prompting for sudo password to cache it for this script run)[0m
[0;34m[2025-05-05T12:48:01] [INFO] → Passwordless sudo rule already exists in /etc/sudoers.d/nextlevel-network[0m
[0;34m[2025-05-05T12:48:01] [INFO] Detecting active network service...[0m
[0;34m[2025-05-05T12:48:01] [INFO] Default network interface: 'en0'[0m
[0;34m[2025-05-05T12:48:01] [INFO] Active service for interface 'en0' is '1
Hardware Port: Wi-Fi, Device: en0'[0m
[0;34m[2025-05-05T12:48:01] [INFO] Active service: '1
Hardware Port: Wi-Fi, Device: en0'[0m
[0;31m[2025-05-05T12:48:02] [ERROR] Could not get Colima VM IP address; skipping Pi-hole/DoH setup.[0m
[0;34m[2025-05-05T12:48:02] [INFO] Skipping Pi-hole and DoH deployment due to earlier checks.[0m
[0;34m[2025-05-05T12:48:02] [INFO] Launching NordVPN GUI…[0m
[0;34m[2025-05-05T12:48:02] [INFO] ▶ open -a NordVPN || true[0m
[0;34m[2025-05-05T12:48:03] [INFO] Pruning Logitech agents…[0m
[0;34m[2025-05-05T12:48:03] [INFO] ----- Health Check -----[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: sysctl -n sysctl.proc_translated &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: curl -s --max-time 5 http://localhost:11434/v1/models &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: curl -s --max-time 5 http://localhost:11434/v1/models 2>/dev/null | grep -q mistral[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: scutil --dns &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: scutil --dns &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: launchctl list com.local.battalert &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: launchctl list com.local.weeklyaudit &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] Checking: launchctl list com.local.doh &>/dev/null[0m
[0;34m[2025-05-05T12:48:03] [INFO] ----- Health Check Summary -----[0m
[0;34m[2025-05-05T12:48:03] [INFO] ARM-only process ✔[0m
[0;34m[2025-05-05T12:48:03] [INFO] Ollama Mistral running ✔[0m
[0;34m[2025-05-05T12:48:03] [INFO] DNS not local ❌[0m
[0;34m[2025-05-05T12:48:03] [INFO] Agent com.local.battalert loaded ✔[0m
[0;34m[2025-05-05T12:48:03] [INFO] Agent com.local.weeklyaudit loaded ✔[0m
[0;34m[2025-05-05T12:48:03] [INFO] --------------------------[0m
[0;34m[2025-05-05T12:48:03] [INFO] Setup complete ✔[0m
